<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Client Basics and Login System Part 1 | EmbeddedFPSExample</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/EmbeddedFPSExample/assets/css/0.styles.32e58400.css" as="style"><link rel="preload" href="/EmbeddedFPSExample/assets/js/app.debd0cf8.js" as="script"><link rel="preload" href="/EmbeddedFPSExample/assets/js/2.6b282e9d.js" as="script"><link rel="preload" href="/EmbeddedFPSExample/assets/js/6.1e5c2305.js" as="script"><link rel="prefetch" href="/EmbeddedFPSExample/assets/js/10.021f36e7.js"><link rel="prefetch" href="/EmbeddedFPSExample/assets/js/11.710a60b5.js"><link rel="prefetch" href="/EmbeddedFPSExample/assets/js/12.dabfb87e.js"><link rel="prefetch" href="/EmbeddedFPSExample/assets/js/13.6ea62ec4.js"><link rel="prefetch" href="/EmbeddedFPSExample/assets/js/14.62a0b14a.js"><link rel="prefetch" href="/EmbeddedFPSExample/assets/js/15.e4fe2066.js"><link rel="prefetch" href="/EmbeddedFPSExample/assets/js/16.92f92ea2.js"><link rel="prefetch" href="/EmbeddedFPSExample/assets/js/17.a10b7396.js"><link rel="prefetch" href="/EmbeddedFPSExample/assets/js/18.1f2cce65.js"><link rel="prefetch" href="/EmbeddedFPSExample/assets/js/19.c0a5a8eb.js"><link rel="prefetch" href="/EmbeddedFPSExample/assets/js/20.2f1b2705.js"><link rel="prefetch" href="/EmbeddedFPSExample/assets/js/3.2e9c32b1.js"><link rel="prefetch" href="/EmbeddedFPSExample/assets/js/4.5667f98c.js"><link rel="prefetch" href="/EmbeddedFPSExample/assets/js/5.a89d39a3.js"><link rel="prefetch" href="/EmbeddedFPSExample/assets/js/7.237b2ecd.js"><link rel="prefetch" href="/EmbeddedFPSExample/assets/js/8.20703bf5.js"><link rel="prefetch" href="/EmbeddedFPSExample/assets/js/9.7cddb3eb.js">
    <link rel="stylesheet" href="/EmbeddedFPSExample/assets/css/0.styles.32e58400.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/EmbeddedFPSExample/" class="home-link router-link-active"><!----> <span class="site-name">EmbeddedFPSExample</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/EmbeddedFPSExample/guide/introduction.html" class="sidebar-link">Introduction</a></li><li><a href="/EmbeddedFPSExample/guide/setting-up-the-projects.html" class="sidebar-link">Setting up the projects</a></li><li><a href="/EmbeddedFPSExample/guide/client-basics-and-login-system-part-1.html" aria-current="page" class="active sidebar-link">Client Basics and Login System Part 1</a></li><li><a href="/EmbeddedFPSExample/guide/server-basics-and-login-system.html" class="sidebar-link">Server Basics and Login System</a></li><li><a href="/EmbeddedFPSExample/guide/room-system-part-1-server-side.html" class="sidebar-link">Room System Part 1 (Server-Side)</a></li><li><a href="/EmbeddedFPSExample/guide/client-login-system-part-2-and-lobby.html" class="sidebar-link">Client Login System Part 2 and Lobby</a></li><li><a href="/EmbeddedFPSExample/guide/room-system-part-2-server-side.html" class="sidebar-link">Room System Part 2 (Server-Side)</a></li><li><a href="/EmbeddedFPSExample/guide/player-movement-interpolation-and-client-side-prediction.html" class="sidebar-link">Player-Movement, Interpolation and Client Side Prediction</a></li><li><a href="/EmbeddedFPSExample/guide/multiplayer-gameplay.html" class="sidebar-link">Multiplayer Gameplay (Synchronization and Buffers)</a></li><li><a href="/EmbeddedFPSExample/guide/reconciliation.html" class="sidebar-link">Reconciliation</a></li><li><a href="/EmbeddedFPSExample/guide/health-shooting-lag-Compensation.html" class="sidebar-link">Health, Shooting, Lag Compensation</a></li><li><a href="/EmbeddedFPSExample/guide/networking-discussion.html" class="sidebar-link">Networking Discussion</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="client-basics-and-login-system-part-1"><a href="#client-basics-and-login-system-part-1" class="header-anchor">#</a> Client Basics and Login System Part 1</h1> <p>We will start by implementing functionality to connect to a server and send a simple login request. Let's create a script that connects our client to a server.</p> <ul><li>In the client project create a &quot;ConnectionManager&quot; script in the Scripts folder.</li> <li>In the main scene create an empty Gameobject and name it &quot;ConnectionManager&quot;</li> <li>Add a UnityClient component to that gameobject (you need to search for just &quot;Client&quot; when adding the component)</li> <li>Set the values of the UnityClient like this:<br> <img src="https://i.imgur.com/gxPD6tI.png" alt=""><br> <strong>Important:</strong> Set Auto Connect to false we will connect in the ConnectionManager!</li></ul> <p>Now we will implement the ConnectionManager. First of all add the ConnectionManager as a component to the ConnectionManaegr gameobject. Then open the ConnectionManager in your favorite IDE.<br>
We want the ConnectionManager to be globally accessible and present in all scenes. That's why we use the singleton pattern and provide a static field to access it. We add the following code:</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Net</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">DarkRift</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">DarkRift<span class="token punctuation">.</span>Client<span class="token punctuation">.</span>Unity</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">UnityEngine</span><span class="token punctuation">;</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">RequireComponent</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">UnityClient</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConnectionManager</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">MonoBehaviour</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ConnectionManager</span> Instance<span class="token punctuation">;</span>

    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Awake</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>Instance <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token function">Destroy</span><span class="token punctuation">(</span>gameObject<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        Instance <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token function">DontDestroyOnLoad</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>This allows us to access ConnectionManager from any script by calling ConnectionManager.Instance, it will also keep the gameobject, where ConnectionManager is attached to, loaded when we swap it. We also make sure that we don't create 2 ConnectionManagers somehow.</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>While this works just fine here, it is not an ideal implementation of the singleton pattern.</p></div> <p>The next step is creating a connection to a server. There are two ways of connecting to a Darkrift server. ConnectInBackGround() and Connect().</p> <ul><li>Connect() will connect to the server and freeze everything until it's connected or failed the connect. You can run code immediately after, to check if the connection worked (it runs synchronously).</li> <li>ConnectInBackGround() connects asynchronously to the server so your code will continue to run and players won't experience a screen freeze. It will invoke a void function of your choice with an exeception parameter as soon as it connected or when the connection failed.</li></ul> <p>We will use ConnectInBackGround because we don't want our clients to freeze for a few seconds after starting up. (In a real application you would also want to display an animated connection screen for the users)</p> <p>We will add some variables and a way to ConnectInBackGround to our ConnectionManager.
Add the following to the ConnectionManager script:</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Header</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;Settings&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">SerializeField</span></span><span class="token punctuation">]</span>
    <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">string</span></span> ipAdress<span class="token punctuation">;</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">SerializeField</span></span><span class="token punctuation">]</span>
    <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">int</span></span> port<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token return-type class-name">UnityClient</span> Client <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">private</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
</code></pre></div><p>And also the following connection code:</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Client<span class="token punctuation">.</span><span class="token function">ConnectInBackground</span><span class="token punctuation">(</span>IPAddress<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>ipAdress<span class="token punctuation">)</span><span class="token punctuation">,</span> port<span class="token punctuation">,</span> IPVersion<span class="token punctuation">.</span>IPv4<span class="token punctuation">,</span> ConnectCallback<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ConnectCallback</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> exception<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>Client<span class="token punctuation">.</span>Connected<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">//here we will add login code later</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
        <span class="token punctuation">{</span>
            Debug<span class="token punctuation">.</span><span class="token function">LogError</span><span class="token punctuation">(</span><span class="token string">&quot;Unable to connect to server.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>To access the Client component in Start we need to reference the component first in Awake so add the following line to the end of the Awake function:</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>Client <span class="token operator">=</span> <span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>UnityClient<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>This code tries to connect to a server when we start unity and as soon as we are connected it will call the ConnectCallback function. The function checks if we are connected or if the connection failed.
This is everything you need to connect to a Darkrift server.</p> <p>Now let's create a simple login interface.
We will only use a username and no password or account management in our login system to keep it simple.</p> <ul><li>Create a &quot;LoginManager&quot; script in the Scripts folder</li> <li>Create a &quot;LoginManager&quot; GameObject in the Main scene.</li> <li>Add the LoginManager script as a component to the LoginManager Gameobject.</li> <li>Create a Canvas and add a Window(UI Image),scale it up to the screen size and then add a Button and a InputField to the window, your scene should look now like this:<br> <img src="/EmbeddedFPSExample/assets/img/loginManager-setup.03acb8c5.png" alt=""></li></ul> <p>Now open the LoginManager and create some references to the login elements</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">DarkRift</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">DarkRift<span class="token punctuation">.</span>Client</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">UnityEngine</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">UnityEngine<span class="token punctuation">.</span>SceneManagement</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">UnityEngine<span class="token punctuation">.</span>UI</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LoginManager</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">MonoBehaviour</span></span>
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Header</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;References&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">SerializeField</span></span><span class="token punctuation">]</span>
    <span class="token keyword">private</span> <span class="token class-name">GameObject</span> loginWindow<span class="token punctuation">;</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">SerializeField</span></span><span class="token punctuation">]</span>
    <span class="token keyword">private</span> <span class="token class-name">InputField</span> nameInput<span class="token punctuation">;</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">SerializeField</span></span><span class="token punctuation">]</span>
    <span class="token keyword">private</span> <span class="token class-name">Button</span> submitLoginButton<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>It would be nice if the login window only appeared once we connected to the server so lets hide it:</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        loginWindow<span class="token punctuation">.</span><span class="token function">SetActive</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>And create a function to activate it:</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">StartLoginProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        loginWindow<span class="token punctuation">.</span><span class="token function">SetActive</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>We want the StartLoginProcess to be called once we are connected. A good way to implement this while keeping the code extensible is using events.
Go to the ConnectionManager script and add the following fields to it to define an event.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>        <span class="token keyword">public</span> <span class="token keyword">delegate</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnConnectedDelegate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token keyword">event</span> <span class="token class-name">OnConnectedDelegate</span> OnConnected<span class="token punctuation">;</span>
</code></pre></div><p>After defining the event let's invoke it in our connection callback if the connection succeeded.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>    <span class="token keyword">if</span> <span class="token punctuation">(</span>Client<span class="token punctuation">.</span>Connected<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        OnConnected<span class="token punctuation">?.</span><span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{</span>
        Debug<span class="token punctuation">.</span><span class="token function">LogError</span><span class="token punctuation">(</span><span class="token string">&quot;Unable to connect to server.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>Now go back to the LoginManager and subscribe to the event. It is considered good practice to always unsubscribe from an event as well so let's add both:</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        ConnectionManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>OnConnected <span class="token operator">+=</span> StartLoginProcess<span class="token punctuation">;</span>
        loginWindow<span class="token punctuation">.</span><span class="token function">SetActive</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        ConnectionManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>OnConnected <span class="token operator">-=</span> StartLoginProcess<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>Now we can code our first message that we send to the server, but first we have to create a new script.</p> <ul><li>Create a NetworkingData script in the Scripts/Shared folder.</li> <li>Open it and remove everything that unity created.</li></ul> <p>Darkrift uses tags to identify messages. A tag is a ushort value(0 to 65,535). We could try to remember all tags but people tend to be better at remembering words so we will use a c# feature to convert our tags into a human readable format.</p> <p>Add the following to the NetworkingData script</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">Tags</span>
<span class="token punctuation">{</span>
    LoginRequest <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
    LoginRequestAccepted <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
    LoginRequestDenied <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>This allows us to use Tags.LoginRequest  as a tag which is easy to remember.
We created 3 tags. LoginRequest is the tag for a message that a client sends to the server when he wants to login.
LoginRequestAccepted and LoginRequestDenied are answers from the server.</p> <p>But we have to send additional data to the server to login. In our case we just send a username but in most cases you would additionally also send a password.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Never send passwords without encryption, you have to use an encryption library to send messages with important information. Usually authentication is also not done by the game server itself but by a separate auth server or a third party provider.</p></div> <p>When we send data to a server we have to serialize it (create a bunch of bytes out of our things that we want to send).
Darkrift does that part for us. We can use a writer to serialize data like this. (Don't write this anywhere its just an example)</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name">DarkriftWriter</span> writer <span class="token operator">=</span> DarkriftWriter<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
writer<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Writes an int value of 5 to the writer</span>
writer<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">ushort</span><span class="token punctuation">)</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment">// writes a ushort value.</span>
</code></pre></div><p>You can also write strings and floats and arrays to a writer. A writer is then used to create a message. A message wants a tag and a writer to send, in its constructor.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name">Message</span> message <span class="token operator">=</span> Message<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span>tag<span class="token punctuation">,</span> writer<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You can the send a message by accessing a UnityClient and calling</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code> UnityClient<span class="token punctuation">.</span><span class="token function">SendMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> sendmode<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>There are 2 send modes in Darkrift SendMode.Reliable and SendMode.Unreliable. We will just use reliable for now and will come back to this point later.</p> <p>On the server when we receive a message we can read values out of the message by creating a DarkriftReader:</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name">DarkriftReader</span> reader <span class="token operator">=</span> Message<span class="token punctuation">.</span><span class="token function">GetReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
reader<span class="token punctuation">.</span><span class="token function">readInt32</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Reads an int</span>
reader<span class="token punctuation">.</span><span class="token function">readuint32</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Reads an ushort</span>
reader<span class="token punctuation">.</span><span class="token function">ReadString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Reads a string</span>
reader<span class="token punctuation">.</span><span class="token function">ReadSingle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Reads a float</span>
</code></pre></div><p>Readers, Writers and Messages should be disposed after using them so call Reader.Dispose() after using them. you can also use using blocks and achieve the same effect for example sending a message correctly looks like this:</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span><span class="token punctuation">(</span><span class="token class-name">DarkriftWriter</span> writer <span class="token operator">=</span> DarkriftWriter<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    writer<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token string">&quot;this is a test message.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">using</span><span class="token punctuation">(</span><span class="token class-name">Message</span> message <span class="token operator">=</span> message<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span>tag<span class="token punctuation">,</span> writer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
         UnityClient<span class="token punctuation">.</span><span class="token function">SendMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> SendMode<span class="token punctuation">.</span>Reliable<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>It is very important that you always read and write the same amount of data. But doing this the way above leaves room for a lot of mistakes and you will end up with a lot of read and write.</p> <p>It would be nice to have a way to simplify that process right? Darkrift has a neat system to do that, IDarkriftSerializables. So instead of using writers and readers we will create a IDarkriftSerializable in our NetworkingData class:</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">struct</span> <span class="token class-name">LoginRequestData</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IDarkRiftSerializable</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">string</span></span> Name<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">LoginRequestData</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Deserialize</span><span class="token punctuation">(</span><span class="token class-name">DeserializeEvent</span> e<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Name <span class="token operator">=</span> e<span class="token punctuation">.</span>Reader<span class="token punctuation">.</span><span class="token function">ReadString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Serialize</span><span class="token punctuation">(</span><span class="token class-name">SerializeEvent</span> e<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span>Writer<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>Name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The LoginRequestData contains data in the form of a string Name and a function Deserialize and Serialize.
These two functions are called when Darkrift sends a message. e.Writer.Write(Name) will &quot;add&quot; the name string to the message when we send it and e.Reader.ReadString(); will read it on the server side and recreate the LoginRequestData. As you can see reading and writing still works in a similar way. But debugging this will be much easier because you can check easily if the serialization of LoginData is correct or wrong. To now send a IDarkriftSerializable you can just put it into a message instead of a writer.</p> <p>So lets add a function to the LoginManager to send a message:</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnSubmitLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>String<span class="token punctuation">.</span><span class="token function">IsNullOrEmpty</span><span class="token punctuation">(</span>nameInput<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            loginWindow<span class="token punctuation">.</span><span class="token function">SetActive</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">Message</span> message <span class="token operator">=</span> Message<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">ushort</span><span class="token punctuation">)</span>Tags<span class="token punctuation">.</span>LoginRequest<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">LoginRequestData</span><span class="token punctuation">(</span>nameInput<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                ConnectionManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>Client<span class="token punctuation">.</span><span class="token function">SendMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> SendMode<span class="token punctuation">.</span>Reliable<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>This function will deactivate the login window and then send a message to the server with the tag LoginRequest (= 0) and data in the form of a LoginRequestData which contains the name entered in the input field. The (ushort) in front of Tags.LoginRequest tells C# to convert LoginRequest back into an actual number.\</p> <p>Finally lets subscribe our login button to that function. To do that add the following in the Start() function:</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>SubmitLoginButton<span class="token punctuation">.</span>onClick<span class="token punctuation">.</span><span class="token function">AddListener</span><span class="token punctuation">(</span>OnSubmitLogin<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>You can also subscribe a function to a button in the Unity UI of the button itself. I prefer to do it in code because it is less messy.</p></div> <p>The scripts should now look like this:</p> <ul><li><a href="https://github.com/LukeStampfli/EmbeddedFPSExample/tree/master/gists/login1-ConnectionManager.cs" target="_blank" rel="noopener noreferrer">ConnectionManager<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/LukeStampfli/EmbeddedFPSExample/tree/master/gists/login1-ConnectionManager.cs" target="_blank" rel="noopener noreferrer">LoginManager<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/LukeStampfli/EmbeddedFPSExample/tree/master/gists/login1-NetworkingData.cs" target="_blank" rel="noopener noreferrer">NetworkingData<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p>Now lets jump to the to the server side...</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/EmbeddedFPSExample/guide/setting-up-the-projects.html" class="prev">
        Setting up the projects
      </a></span> <span class="next"><a href="/EmbeddedFPSExample/guide/server-basics-and-login-system.html">
        Server Basics and Login System
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/EmbeddedFPSExample/assets/js/app.debd0cf8.js" defer></script><script src="/EmbeddedFPSExample/assets/js/2.6b282e9d.js" defer></script><script src="/EmbeddedFPSExample/assets/js/6.1e5c2305.js" defer></script>
  </body>
</html>
